(window.webpackJsonp=window.webpackJsonp||[]).push([[5],{207:function(t,s,a){t.exports=a.p+"assets/img/22.5f086cca.png"},208:function(t,s,a){t.exports=a.p+"assets/img/23.05ad31ee.png"},209:function(t,s,a){t.exports=a.p+"assets/img/21.bb926fbd.png"},210:function(t,s,a){t.exports=a.p+"assets/img/17.46ad5821.png"},211:function(t,s,a){t.exports=a.p+"assets/img/18.8246e647.png"},212:function(t,s,a){t.exports=a.p+"assets/img/19.0bf9a308.png"},213:function(t,s,a){t.exports=a.p+"assets/img/20.79a60e14.png"},329:function(t,s,a){"use strict";a.r(s);var n=a(27),e=Object(n.a)({},(function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[n("h2",{attrs:{id:"event-loop"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#event-loop"}},[t._v("#")]),t._v(" Event Loop")]),t._v(" "),n("h3",{attrs:{id:"进程与线程"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#进程与线程"}},[t._v("#")]),t._v(" 进程与线程")]),t._v(" "),n("p",[t._v("进程是操作系统分配资源和调度任务的基本单位，线程是建立在进程上的一次程序运行单位，一个进程上可以有多个线程")]),t._v(" "),n("ol",[n("li",[n("p",[t._v("浏览器线程")]),t._v(" "),n("ul",[n("li",[t._v("用户界面-包括地址栏、前进/后退按钮、书签菜单等")]),t._v(" "),n("li",[t._v("浏览器引起-在用户界面和呈现引擎之间传送指令（浏览器的主进程）")]),t._v(" "),n("li",[t._v("渲染引擎，也被称为浏览器内核（浏览器渲染进程）")]),t._v(" "),n("li",[t._v("一个插件对应一个进程（第三方插件进程）")]),t._v(" "),n("li",[t._v("GPU 提高网页浏览的体验（GPU 进程）")])])]),t._v(" "),n("li",[n("p",[t._v("浏览器渲染引擎")]),t._v(" "),n("ul",[n("li",[t._v("渲染引擎内部是多线程的，内部包括 ui 线程和 js 线程")]),t._v(" "),n("li",[t._v("js 线程、ui 线程，这两个线程互斥，目的就是为了保证不产生冲突")]),t._v(" "),n("li",[t._v("ui 线程会把更改的放到队列中，当 js 线程空闲下来的时候，ui 线程在继续渲染。")])])])]),t._v(" "),n("blockquote",[n("p",[t._v("js 引擎是一个专门处理 JavaScript 脚本的虚拟机，一般会附带在网页浏览器之中，比如最出名的就是 chrome 浏览器的 v8 引擎。")])]),t._v(" "),n("ol",{attrs:{start:"3"}},[n("li",[n("p",[t._v("js 单线程")]),t._v(" "),n("ul",[n("li",[t._v("js 是单线程。单线程指的是主线程是单线程，所以在 node 中依旧是单线程的。")])])]),t._v(" "),n("li",[n("p",[t._v("webworker 多线程")]),t._v(" "),n("ul",[n("li",[t._v("它和 js 主线程不是平级的，主线程可以控制 webworker，但是 webworker 不能操作 DOM，不能获取 document、window")])])]),t._v(" "),n("li",[n("p",[t._v("其他线程")]),t._v(" "),n("ul",[n("li",[t._v("浏览器事件触发线程（用来控制事件循环，存放 setTimeout、浏览器事件、ajax 的回调函数）")]),t._v(" "),n("li",[t._v("定时触发器线程（setTimeout 定时器所在线程）")]),t._v(" "),n("li",[t._v("异步 HTTP 请求线程（ajax 请求线程）")])])])]),t._v(" "),n("blockquote",[n("p",[t._v("单线程特点是节约了内存，并且不需要在切换执行上下文。而且单线程不需要管锁的问题，所谓锁，在 Java 里才有锁的概念")])]),t._v(" "),n("h3",{attrs:{id:"执行栈"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#执行栈"}},[t._v("#")]),t._v(" 执行栈")]),t._v(" "),n("p",[t._v("每一个函数执行的时候，都会生成新的 execution context stack(执行上下文)，执行上下文会包含一些当前函数的参数，局部变量之类的信息，它会被推入栈中，running execution context（正在执行的上下文——始终处于栈的顶部。当函数执行完后，它的执行上下文会从栈弹出。")]),t._v(" "),n("p",[n("img",{attrs:{src:a(207),alt:"执行栈的流程"}})]),t._v(" "),n("div",{staticClass:"language-js line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("bar")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  console"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"bar"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("foo")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  console"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"foo"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("bar")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("foo")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br"),n("span",{staticClass:"line-number"},[t._v("3")]),n("br"),n("span",{staticClass:"line-number"},[t._v("4")]),n("br"),n("span",{staticClass:"line-number"},[t._v("5")]),n("br"),n("span",{staticClass:"line-number"},[t._v("6")]),n("br"),n("span",{staticClass:"line-number"},[t._v("7")]),n("br"),n("span",{staticClass:"line-number"},[t._v("8")]),n("br"),n("span",{staticClass:"line-number"},[t._v("9")]),n("br"),n("span",{staticClass:"line-number"},[t._v("10")]),n("br")])]),n("p",[t._v("执行过程中栈的变化：")]),t._v(" "),n("p",[n("img",{attrs:{src:a(208),alt:"执行栈的变化"}})]),t._v(" "),n("h3",{attrs:{id:"什么是-event-loop，为什么需要-event-loop"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#什么是-event-loop，为什么需要-event-loop"}},[t._v("#")]),t._v(" 什么是 Event Loop，为什么需要 Event Loop")]),t._v(" "),n("div",{staticClass:"custom-block tip"},[n("p",{staticClass:"custom-block-title"},[t._v("TIP")]),t._v(" "),n("p",[t._v("Event Loop 是一个程序结构，用于等待和发送消息和事件。")]),t._v(" "),n("p",[t._v("主线程从”任务队列“中读取执行事件，不断循环重复的过程——事件循环（Event Loop）")])]),t._v(" "),n("p",[t._v("换句话说，就是在程序中设置两个线程： 一个负责程序本身的运行，称为”主线程“；另一个负责主线程与其他进程（主要是各种 I/O 操作）的通信，被称为”Event Loop“线程（可以译为”消息线程“")]),t._v(" "),n("p",[t._v("JavaScript 是单线程的，单线程意味着，它一次只能执行一段代码。所有任务都需要排队，前一个任务结束，才会执行后一个任务。")]),t._v(" "),n("ul",[n("li",[t._v("浏览器的 Event Loop 是在 html5 的规范中明确定义。")]),t._v(" "),n("li",[t._v("NodeJS 的 Event Loop 是基于 libuv 实现的。可以参考 Node 的官方文档以及 libuv 的官方文档。")]),t._v(" "),n("li",[t._v("libuv 已经对 Event Loop 做出了实现，而 HTML5 规范中只是定义了浏览器中 Event Loop 的模型，具体的实现留给了浏览器厂商。")])]),t._v(" "),n("h3",{attrs:{id:"浏览器-event-loop"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#浏览器-event-loop"}},[t._v("#")]),t._v(" 浏览器 Event Loop")]),t._v(" "),n("p",[n("img",{attrs:{src:a(209),alt:"浏览器的event loop"}})]),t._v(" "),n("h4",{attrs:{id:"浏览器执行栈如何进行"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#浏览器执行栈如何进行"}},[t._v("#")]),t._v(" 浏览器执行栈如何进行")]),t._v(" "),n("p",[t._v("事件循环可以简单描述为：")]),t._v(" "),n("ol",[n("li",[n("p",[t._v("函数入栈，当栈 stack 中执行到异步任务的时候，就将它丢给 WebAPIs，接着执行同步任务，知道 Stack 为空")])]),t._v(" "),n("li",[n("p",[t._v("在此期间 WebAPIs 完成这个事件，把回调函数放入 CallbackQueue 中等待")])]),t._v(" "),n("li",[n("p",[t._v("当执行栈为空时，Event Loop 把 CallbackQueue 中的一个任务放入 STack 中，回到第一步")]),t._v(" "),n("ul",[n("li",[t._v("Event Loop 是由 javascript 宿主环境（像浏览器）来实现的;")]),t._v(" "),n("li",[t._v("WebAPIs 是由 C++实现的浏览器创建的线程，处理诸如 DOM 事件、http 请求、定时器等异步事件;")]),t._v(" "),n("li",[t._v('JavaScript 的并发模型基于"事件循环";')]),t._v(" "),n("li",[t._v("Callback Queue(Event Queue 或者 Message Queue) 任务队列,存放异步任务的回调函数")])])])]),t._v(" "),n("p",[t._v("如下例子：")]),t._v(" "),n("div",{staticClass:"language-js line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" start "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Date")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("setTimeout")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("cb")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  console"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"时间间隔："')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Date")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" start "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"ms"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("500")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("while")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Date")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" start "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1000")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br"),n("span",{staticClass:"line-number"},[t._v("3")]),n("br"),n("span",{staticClass:"line-number"},[t._v("4")]),n("br"),n("span",{staticClass:"line-number"},[t._v("5")]),n("br")])]),n("ul",[n("li",[t._v("main(Script) 函数入栈,start 变量开始初始化")]),t._v(" "),n("li",[t._v("setTimeout 入栈,出栈,丢给 WebAPIs,开始定时 500ms;")]),t._v(" "),n("li",[t._v("while 循环入栈,开始阻塞 1000ms;")]),t._v(" "),n("li",[t._v("500ms 过后,WebAPIs 把 cb()放入任务队列,此时 while 循环还在栈中,cb()等待;")]),t._v(" "),n("li",[t._v("又过了 500ms,while 循环执行完毕从栈中弹出,main()弹出,此时栈为空,Event Loop,cb()进入栈,log()进栈,输出'时间间隔：1003ms',出栈,cb()出栈")])]),t._v(" "),n("h4",{attrs:{id:"浏览器——js-引擎的运行机制"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#浏览器——js-引擎的运行机制"}},[t._v("#")]),t._v(" 浏览器——js 引擎的运行机制")]),t._v(" "),n("p",[t._v("js 引擎主要有两个组件构成：")]),t._v(" "),n("ol",[n("li",[t._v("堆 heap——内存分配发生地址")]),t._v(" "),n("li",[t._v("栈 stack——函数调用时会行程一个个栈帧（frame）")])]),t._v(" "),n("p",[t._v("JavaScript 的运行机制：")]),t._v(" "),n("ol",[n("li",[t._v("所有同步任务都在主线程上执行，形成一个”执行栈“（execution context stack）")]),t._v(" "),n("li",[t._v("主线程之外，存在一个”任务队列“（task queue），在走主流程的时候，如果碰到异步任务，那么就在“任务队列”中放置这个异步任务")]),t._v(" "),n("li",[t._v("一旦“执行栈”中所有同步任务执行完毕，系统就会读取“任务队列”，看看里面存在哪些事件。哪些对应的异步任务，结束等等状态，进入执行栈，开始执行。")]),t._v(" "),n("li",[t._v("主线程不断重复上面三个步骤")])]),t._v(" "),n("div",{staticClass:"custom-block tip"},[n("p",{staticClass:"custom-block-title"},[t._v("JavaScript 代码的具体流程")]),t._v(" "),n("ul",[n("li",[t._v("执行全局 Script 同步代码，这些同步代码有一些是同步语句，有一些是异步语句（比如 setTimeout 等）；")]),t._v(" "),n("li",[t._v("全局 Script 代码执行完毕后，调用栈 Stack 会清空；")]),t._v(" "),n("li",[t._v("从微队列 microtask queue 中取出位于队首的回调任务，放入调用栈 Stack 中执行，执行完后 microtask queue 长- 度减 1；")]),t._v(" "),n("li",[t._v("继续取出位于队首的任务，放入调用栈 Stack 中执行，以此类推，直到直到把 microtask queue 中的所有任务都执行- 完毕。注意，如果在执行 microtask 的过程中，又产生了 microtask，那么会加入到队列的末尾，也会在这个周期被- 调用执行；")]),t._v(" "),n("li",[t._v("microtask queue 中的所有任务都执行完毕，此时 microtask queue 为空队列，调用栈 Stack 也为空；")]),t._v(" "),n("li",[t._v("取出宏队列 macrotask queue 中位于队首的任务，放入 Stack 中执行；")]),t._v(" "),n("li",[t._v("执行完毕后，调用栈 Stack 为空；")]),t._v(" "),n("li",[t._v("重复第 3-7 个步骤；")])])]),t._v(" "),n("p",[t._v("而 JavaScript 的异步任务，还细分两种任务：")]),t._v(" "),n("ul",[n("li",[t._v("宏任务（macrotask）也叫做 tasks： script（整体代码）、setTimeout、setInterval、setImmediate（node 独有）、XMLHTTPRequest.prototype.onload、I/O、UI 渲染")]),t._v(" "),n("li",[t._v("微任务（microtask）也叫做 jobs： Promise、mutationObserver（不兼容、已废弃）、process.nextTick （node 独有）、Object.observe（已废弃）、MessageChannel（Vue 中 nextTick 实现原理）")])]),t._v(" "),n("blockquote",[n("p",[t._v("原生 promise（有些实现 promise 将 then 方法放到了宏任务 macrotask 中，浏览器默认放到微任务 microtask")])]),t._v(" "),n("div",{staticClass:"custom-block tip"},[n("p",{staticClass:"custom-block-title"},[t._v("TIP")]),t._v(" "),n("p",[t._v("同步代码先执行，执行是在栈中执行的，微任务 microtask 大于宏任务 macrotask，微任务 microtask 会先执行（栈 stack），宏任务后执行（队列 queue）")])]),t._v(" "),n("h3",{attrs:{id:"nodejs-的-event-loop"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#nodejs-的-event-loop"}},[t._v("#")]),t._v(" NodeJS 的 Event Loop")]),t._v(" "),n("h4",{attrs:{id:"nodejs-是什么"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#nodejs-是什么"}},[t._v("#")]),t._v(" NodeJS 是什么")]),t._v(" "),n("p",[t._v("NodeJS 是一个基于 Chrome V8 引擎的 JavaScript 运行环境，node 不是一门语言，是让 js 运行在后端的，运行时不包括 js 全集，因为服务端中不包含 DOM 和 BOM，node 也提供了一些新的模块，比如 http、fs 等模块")]),t._v(" "),n("h4",{attrs:{id:"nodejs-解决了什么"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#nodejs-解决了什么"}},[t._v("#")]),t._v(" NodeJS 解决了什么")]),t._v(" "),n("p",[t._v("node 的首要目标是提供一种简单，用于创建高性能服务器的开发工具 web 服务器的瓶颈在于并发的用户量，对比 Java 和 PHP 的实现方式")]),t._v(" "),n("h4",{attrs:{id:"node-在处理高并发，i-o-密集场景有明显的性能优势"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#node-在处理高并发，i-o-密集场景有明显的性能优势"}},[t._v("#")]),t._v(" node 在处理高并发，I/O 密集场景有明显的性能优势")]),t._v(" "),n("ul",[n("li",[t._v("高并发，是指在同一事件并发访问服务器")]),t._v(" "),n("li",[t._v("I/O 密集指的是文件操作、网络操作、数据库，相对的有 CPU 密集，CPU 密集指的是逻辑处理运算、压缩、解压、加密、解密")])]),t._v(" "),n("blockquote",[n("p",[t._v("Web 主要场景就是接受客户端的请求读取静态资源和渲染界面，所以 node 非常适合 web 应用的开发")])]),t._v(" "),n("p",[t._v("先看一张 libuv 的结构图")]),t._v(" "),n("p",[n("img",{attrs:{src:a(210),alt:"libuv结构图"}})]),t._v(" "),n("h4",{attrs:{id:"nodejs-的宏任务和微任务"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#nodejs-的宏任务和微任务"}},[t._v("#")]),t._v(" NodeJS 的宏任务和微任务")]),t._v(" "),n("p",[t._v("NodeJS 的 Event Loop 中，执行宏任务的回调任务有 6 个阶段，如下图")]),t._v(" "),n("div",{staticClass:"language-js line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[t._v("   ┌───────────────────────────┐\n┌─"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("│           timers          │\n│  └─────────────┬─────────────┘\n│  ┌─────────────┴─────────────┐\n│  │     "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("pending")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token constant"}},[t._v("IO")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" callbacks │\n│  └─────────────┬─────────────┘\n│  ┌─────────────┴─────────────┐\n│  │       idle"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" prepare       │\n│  └─────────────┬─────────────┘      ┌───────────────┐\n│  ┌─────────────┴─────────────┐      │   incoming"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("   │\n│  │           poll            │"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("─────┤  connections"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" │\n│  └─────────────┬─────────────┘      │   data"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" etc"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("  │\n│  ┌─────────────┴─────────────┐      └───────────────┘\n│  │           check           │\n│  └─────────────┬─────────────┘\n│  ┌─────────────┴─────────────┐\n└──┤      close callbacks      │\n   └───────────────────────────┘\n\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br"),n("span",{staticClass:"line-number"},[t._v("3")]),n("br"),n("span",{staticClass:"line-number"},[t._v("4")]),n("br"),n("span",{staticClass:"line-number"},[t._v("5")]),n("br"),n("span",{staticClass:"line-number"},[t._v("6")]),n("br"),n("span",{staticClass:"line-number"},[t._v("7")]),n("br"),n("span",{staticClass:"line-number"},[t._v("8")]),n("br"),n("span",{staticClass:"line-number"},[t._v("9")]),n("br"),n("span",{staticClass:"line-number"},[t._v("10")]),n("br"),n("span",{staticClass:"line-number"},[t._v("11")]),n("br"),n("span",{staticClass:"line-number"},[t._v("12")]),n("br"),n("span",{staticClass:"line-number"},[t._v("13")]),n("br"),n("span",{staticClass:"line-number"},[t._v("14")]),n("br"),n("span",{staticClass:"line-number"},[t._v("15")]),n("br"),n("span",{staticClass:"line-number"},[t._v("16")]),n("br"),n("span",{staticClass:"line-number"},[t._v("17")]),n("br"),n("span",{staticClass:"line-number"},[t._v("18")]),n("br"),n("span",{staticClass:"line-number"},[t._v("19")]),n("br")])]),n("ul",[n("li",[t._v("定时器（timers）：本阶段执行已经被 setTimeout()和 setInterval()的调度回调函数。")]),t._v(" "),n("li",[t._v("待定回调（pending callbacks): 执行延迟下一个循环迭代的 I/O 回调")]),t._v(" "),n("li",[t._v("idle,prepare：仅系统内部使用。")]),t._v(" "),n("li",[t._v("轮询（poll）：检索新的 I/O 事件；执行与 I/O 相关的回调（几乎所有情况下，除了关闭的回调函数，那些由计时器和 setImmediate() 调度的之外），其余情况 Node 将在适当的时候在此阻塞。")]),t._v(" "),n("li",[t._v("检测（check）：setImmediate() 回调函数在这里执行。")]),t._v(" "),n("li",[t._v("关闭的回调函数（close callbacks）：一些关闭的回调函数，如：socket.on('close',...)")])]),t._v(" "),n("p",[n("strong",[t._v("同步、异步，阻塞和非阻塞")])]),t._v(" "),n("ul",[n("li",[t._v("阻塞和非阻塞指的是调用者的状态，关注的是程序在等待调用结果时的状态")]),t._v(" "),n("li",[t._v("同步和异步指的是被调用者是如何通知的，关注的是消息通知机制")])]),t._v(" "),n("p",[n("strong",[t._v("NodeJS 中宏任务主要有 4 个")])]),t._v(" "),n("p",[t._v("从上面图可以看出，回调事件主要位于 4 个 macrotask queue 中")]),t._v(" "),n("ol",[n("li",[t._v("Timer Queue")]),t._v(" "),n("li",[t._v("IO Callback Queue")]),t._v(" "),n("li",[t._v("Check Queue")]),t._v(" "),n("li",[t._v("Close Callback Queue")])]),t._v(" "),n("p",[t._v("NodeJS 中上面 4 个都属于宏任务，但是在浏览器中只有一个宏任务，所有的 macrotask 都会被加到这个宏任务队列中，但是 NodeJS 中，不同的 macrotask 会被防止在不同的宏任务中。")]),t._v(" "),n("p",[n("strong",[t._v("NodeJS 中微任务主要有 2 个")])]),t._v(" "),n("ol",[n("li",[t._v("NextTick Queue： 是放置 process.nextTick 的回调任务的")]),t._v(" "),n("li",[t._v("Other Micro Queue： 放置其他 microtask，比如 promise 等")])]),t._v(" "),n("p",[t._v("在浏览器中，也可以认为只有一个微任务队列，所有的 microtask 都会被加到这一个微任务队列中，但是在 NodeJS 中，不同的 microtask 会被放置在不同的微任务队列中")]),t._v(" "),n("p",[n("img",{attrs:{src:a(211),alt:"NodeJS的事件循环"}})]),t._v(" "),n("p",[t._v("NodeJS 的 Event Loop 过程：")]),t._v(" "),n("ol",[n("li",[t._v("执行全局 script 的同步代码")]),t._v(" "),n("li",[t._v("执行 microtask 微任务，先执行所有 Next Tick Queue 的所有与任务，再执行 other Microtask queue 中额微任务")]),t._v(" "),n("li",[t._v("开始执行 macrotask 宏任务，共 6 个阶段，从第 1 个阶段开始执行相应每一个节点 macrotask 中的所有任务，注意，这里所有每个阶段宏任务队列的所有任务，在浏览器的 Event Loop 中只取宏任务的第一个任务出来执行，每一个阶段 macrotask 任务执行完毕后，开始执行微任务，也就是步骤 2")]),t._v(" "),n("li",[t._v("Timers Queue -> 步骤 2 -> I/O Queue -> 步骤 2 -> Check Queue -> 步骤 2 -> Close Callback Queue -> 步骤 2 -> Timers Queue ......")])]),t._v(" "),n("blockquote",[n("p",[t._v("setImmediate: NodeJS 发现使用 setTimeout 和 setInterval 有些小弊端，该方法被设计为一旦在当前轮询阶段完成，就执行这个脚本")])]),t._v(" "),n("blockquote",[n("p",[t._v("process.nextTick() 存在自己的队列，它独立于 Event Loop，无论 Event Loop 处于何种阶段，都会在阶段结束的时候清空 nextTick 队列")])]),t._v(" "),n("div",{staticClass:"custom-block tip"},[n("p",{staticClass:"custom-block-title"},[t._v("TIP")]),t._v(" "),n("p",[t._v("process.nextTick()优先于其他微任务（microtask）执行")])]),t._v(" "),n("p",[n("img",{attrs:{src:a(212),alt:"NodeJS的microtask"}})]),t._v(" "),n("p",[n("img",{attrs:{src:a(213),alt:"NodeJS的macrotask"}})]),t._v(" "),n("h3",{attrs:{id:"浏览器和-nodejs-的-event-loop-区别"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#浏览器和-nodejs-的-event-loop-区别"}},[t._v("#")]),t._v(" 浏览器和 NodeJS 的 Event Loop 区别")]),t._v(" "),n("ol",[n("li",[t._v("宏任务、微任务在浏览器和 node 环境执行顺序不同")])]),t._v(" "),n("div",{staticClass:"language-js line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 这个列子里面，包含了宏任务，微任务，分别看看浏览器和node 打印的结果")]),t._v("\nconsole"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 栈")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("setTimeout")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  console"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 微任务")]),t._v("\n  Promise"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("resolve")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("100")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("then")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    console"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"promise"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 栈")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" promise "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Promise")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("resolve"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" reject")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  console"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("7")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("resolve")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("100")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("then")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("data")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 微任务")]),t._v("\n  console"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("data"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 栈")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("setTimeout")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  console"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nconsole"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("5")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 浏览器结果：1 7 5 100 2 promise 3")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// node 结果：  1 7 5 100 2 3 promise")]),t._v("\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br"),n("span",{staticClass:"line-number"},[t._v("3")]),n("br"),n("span",{staticClass:"line-number"},[t._v("4")]),n("br"),n("span",{staticClass:"line-number"},[t._v("5")]),n("br"),n("span",{staticClass:"line-number"},[t._v("6")]),n("br"),n("span",{staticClass:"line-number"},[t._v("7")]),n("br"),n("span",{staticClass:"line-number"},[t._v("8")]),n("br"),n("span",{staticClass:"line-number"},[t._v("9")]),n("br"),n("span",{staticClass:"line-number"},[t._v("10")]),n("br"),n("span",{staticClass:"line-number"},[t._v("11")]),n("br"),n("span",{staticClass:"line-number"},[t._v("12")]),n("br"),n("span",{staticClass:"line-number"},[t._v("13")]),n("br"),n("span",{staticClass:"line-number"},[t._v("14")]),n("br"),n("span",{staticClass:"line-number"},[t._v("15")]),n("br"),n("span",{staticClass:"line-number"},[t._v("16")]),n("br"),n("span",{staticClass:"line-number"},[t._v("17")]),n("br"),n("span",{staticClass:"line-number"},[t._v("18")]),n("br"),n("span",{staticClass:"line-number"},[t._v("19")]),n("br"),n("span",{staticClass:"line-number"},[t._v("20")]),n("br"),n("span",{staticClass:"line-number"},[t._v("21")]),n("br"),n("span",{staticClass:"line-number"},[t._v("22")]),n("br"),n("span",{staticClass:"line-number"},[t._v("23")]),n("br"),n("span",{staticClass:"line-number"},[t._v("24")]),n("br"),n("span",{staticClass:"line-number"},[t._v("25")]),n("br")])]),n("blockquote",[n("p",[t._v("浏览器和 node 环境执行顺序不同，浏览器是先把一个栈以及栈中的微任务走完，才会走下一个栈。node 环境里面是把所有栈走完，才走微任务")])]),t._v(" "),n("ol",{attrs:{start:"2"}},[n("li",[t._v("setTimeout、setImmediate 都是宏任务、谁先执行")])]),t._v(" "),n("div",{staticClass:"language-js line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{pre:!0,attrs:{class:"token function"}},[t._v("setTimeout")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  console"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"timeout"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("setImmediate")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  console"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"setImmediate"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 结果打印：timeout setImmediate")]),t._v("\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br"),n("span",{staticClass:"line-number"},[t._v("3")]),n("br"),n("span",{staticClass:"line-number"},[t._v("4")]),n("br"),n("span",{staticClass:"line-number"},[t._v("5")]),n("br"),n("span",{staticClass:"line-number"},[t._v("6")]),n("br"),n("span",{staticClass:"line-number"},[t._v("7")]),n("br")])]),n("p",[t._v("setTimeout setImmediate 这两个取决于 node 的执行时间")]),t._v(" "),n("ol",{attrs:{start:"3"}},[n("li",[t._v("nextTick 和 then 都属于微任务，谁优先执行呢")])]),t._v(" "),n("div",{staticClass:"language-js line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[t._v("process"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("nextTick")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  console"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"nextTick"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nPromise"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("resolve")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("then")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  console"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"then"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 结果打印：nextTick then")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 再加一个宏任务呢")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("setImmediate")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  console"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"setImmediate"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 结果打印：nextTick  then  setImmediate")]),t._v("\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br"),n("span",{staticClass:"line-number"},[t._v("3")]),n("br"),n("span",{staticClass:"line-number"},[t._v("4")]),n("br"),n("span",{staticClass:"line-number"},[t._v("5")]),n("br"),n("span",{staticClass:"line-number"},[t._v("6")]),n("br"),n("span",{staticClass:"line-number"},[t._v("7")]),n("br"),n("span",{staticClass:"line-number"},[t._v("8")]),n("br"),n("span",{staticClass:"line-number"},[t._v("9")]),n("br"),n("span",{staticClass:"line-number"},[t._v("10")]),n("br"),n("span",{staticClass:"line-number"},[t._v("11")]),n("br"),n("span",{staticClass:"line-number"},[t._v("12")]),n("br"),n("span",{staticClass:"line-number"},[t._v("13")]),n("br")])]),n("blockquote",[n("p",[t._v("nextTick 会其他微任务优先级高，且高于宏任务")])]),t._v(" "),n("ol",{attrs:{start:"4"}},[n("li",[t._v("i/o 文件操作（宏任务），搭配微任务，谁优先执行")])]),t._v(" "),n("div",{staticClass:"language-js line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" fs "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"fs"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nfs"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("readFile")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"./1/log"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  console"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"fs"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nprocess"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("nextTick")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  console"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"text"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 结果打印：text  fs")]),t._v("\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br"),n("span",{staticClass:"line-number"},[t._v("3")]),n("br"),n("span",{staticClass:"line-number"},[t._v("4")]),n("br"),n("span",{staticClass:"line-number"},[t._v("5")]),n("br"),n("span",{staticClass:"line-number"},[t._v("6")]),n("br"),n("span",{staticClass:"line-number"},[t._v("7")]),n("br"),n("span",{staticClass:"line-number"},[t._v("8")]),n("br")])]),n("p",[t._v("i/o 文件操作(宏任务), 如果有微任务，先执行微任务，在执行文件读取")])])}),[],!1,null,null,null);s.default=e.exports}}]);